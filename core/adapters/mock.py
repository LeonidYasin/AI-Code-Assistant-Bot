import asyncio
from typing import List, Dict

class MockAdapter:
    """Mock AI adapter –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"""
    
    def __init__(self, model: str = None):
        self.model = model or "mock-demo"
        
    async def ask(self, messages: List[Dict[str, str]]) -> str:
        """–ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ AI"""
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–º–∞
        await asyncio.sleep(1)
        
        # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_message = ""
        for msg in reversed(messages):
            if msg.get("role") == "user":
                user_message = msg.get("content", "")
                break
        
        # –ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        user_lower = user_message.lower()
        
        if "–ø—Ä–∏–≤–µ—Ç" in user_lower or "hello" in user_lower:
            return """–ü—Ä–∏–≤–µ—Ç! üëã –Ø AI Code Assistant! 

–Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å:
üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–¥–∞
üîç –ê–Ω–∞–ª–∏–∑–æ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞  
üêõ –ü–æ–∏—Å–∫–æ–º –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –æ—à–∏–±–æ–∫
üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"""

        elif "–∫—Ç–æ" in user_lower and ("—Ç—ã" in user_lower or "–≤—ã" in user_lower):
            return """–Ø AI Code Assistant - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

ü§ñ –ú–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
‚Ä¢ –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∏ –ø–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º
‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
‚Ä¢ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
‚Ä¢ –û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é
‚Ä¢ –û—Ç–ª–∞–¥–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

–°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é –≤ demo-—Ä–µ–∂–∏–º–µ. –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤ .env —Ñ–∞–π–ª–µ."""

        elif "fibonacci" in user_lower:
            return """–û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä! –§—É–Ω–∫—Ü–∏—è Fibonacci –≤ –≤–∞—à–µ–º –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∫—É—Ä—Å–∏—é, —á—Ç–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

üîç –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```python
def fibonacci(n):
    if n <= 0: return 0
    elif n == 1: return 1
    else: return fibonacci(n-1) + fibonacci(n-2)  # ‚ùå –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
```

‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:
```python
def fibonacci_optimized(n):
    if n <= 0: return 0
    elif n == 1: return 1
    
    a, b = 0, 1
    for _ in range(2, n + 1):
        a, b = b, a + b
    return b
```

üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚Ä¢ –í—Ä–µ–º—è: O(n) –≤–º–µ—Å—Ç–æ O(2^n)
‚Ä¢ –ü–∞–º—è—Ç—å: O(1) –≤–º–µ—Å—Ç–æ O(n)
‚Ä¢ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö n"""

        elif "analyze" in user_lower or "–∞–Ω–∞–ª–∏–∑" in user_lower:
            return """üìä –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ (Demo —Ä–µ–∂–∏–º):

‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞: –•–æ—Ä–æ—à–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞
‚úÖ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π
‚ö†Ô∏è  –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ï—Å—Ç—å docstring

üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. –ó–∞–º–µ–Ω–∏—Ç–µ —Ä–µ–∫—É—Ä—Å–∏—é –Ω–∞ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥
2. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –º–µ–º–æ–∏–∑–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
4. –î–æ–±–∞–≤—å—Ç–µ type hints –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä."""

        elif "–∫–æ–¥" in user_lower or "code" in user_lower:
            return """üíª –ö–æ–Ω–µ—á–Ω–æ, –ø–æ–º–æ–≥—É —Å –∫–æ–¥–æ–º!

–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
‚Ä¢ –ù–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
‚Ä¢ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É  
‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
‚Ä¢ –û–±—ä—è—Å–Ω–∏—Ç—å —Å–ª–æ–∂–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
‚Ä¢ –í—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ—Å—Ç–æ –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É, –∏ —è –ø—Ä–µ–¥–ª–æ–∂—É —Ä–µ—à–µ–Ω–∏–µ!

üìù –ü—Ä–∏–º–µ—Ä: "–ù–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π –ø–æ –∫–ª—é—á—É" """

        elif "–ø–æ–º–æ—â—å" in user_lower or "help" in user_lower:
            return """üÜò –°–ø—Ä–∞–≤–∫–∞ –ø–æ AI Code Assistant:

üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ —á–∞—Ç–µ:
/help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/analyze <file> - –∞–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞ –∫–æ–¥–∞
/model - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ AI –º–æ–¥–µ–ª–∏  
/history - –∏—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
/clear - –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
/exit - –≤—ã—Ö–æ–¥

üí¨ –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:
‚Ä¢ "–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É: [–∫–æ–¥ —Å –æ—à–∏–±–∫–æ–π]"
‚Ä¢ "–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é: [–∫–æ–¥]"
‚Ä¢ "–û–±—ä—è—Å–Ω–∏ –∞–ª–≥–æ—Ä–∏—Ç–º –±—ã—Å—Ç—Ä–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏"
‚Ä¢ "–ù–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —á—Ç–µ–Ω–∏—è CSV —Ñ–∞–π–ª–∞"

üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ AI:
–î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª —Å API –∫–ª—é—á–∞–º–∏."""

        else:
            return f"""ü§ñ Demo –æ—Ç–≤–µ—Ç –Ω–∞: "{user_message}"

–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º. –Ø –ø–æ–Ω–∏–º–∞—é –≤–∞—à –≤–æ–ø—Ä–æ—Å, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä.

üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å:
‚Ä¢ "–ü—Ä–∏–≤–µ—Ç, –∫—Ç–æ —Ç—ã?"
‚Ä¢ "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–¥"  
‚Ä¢ "–ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å fibonacci?"
‚Ä¢ "–ü–æ–º–æ—â—å"

üîß –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ AI:
1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω: https://huggingface.co/settings/tokens
2. –û–±–Ω–æ–≤–∏—Ç–µ .env: HF_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —á–∞—Ç

–°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é –≤ demo-—Ä–µ–∂–∏–º–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."""